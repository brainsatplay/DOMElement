var f=Object.defineProperty;var g=(i,d,e)=>d in i?f(i,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[d]=e;var o=(i,d,e)=>(g(i,typeof d!="symbol"?d+"":d,e),e);var c=class extends HTMLElement{constructor(){super();o(this,"template",e=>`<div> Custom Fragment Props: ${JSON.stringify(e)} </div>`);o(this,"props",{test:!0});o(this,"useShadow",!1);o(this,"styles");o(this,"oncreate");o(this,"onresize");o(this,"ondelete");o(this,"onchanged");o(this,"renderonchanged",!1);o(this,"FRAGMENT");o(this,"attachedShadow",!1);o(this,"obsAttributes",["props","options","onchanged","onresize","ondelete","oncreate","template"]);o(this,"delete",()=>{this.remove(),typeof this.ondelete=="function"&&this.ondelete(this.props)});o(this,"render",(e=this.props)=>{typeof this.template=="function"?this.templateString=this.template(e):this.templateString=this.template;let r=document.createElement("template");r.innerHTML=this.templateString;let s=r.content;this.FRAGMENT&&(this.useShadow?this.shadowRoot.removeChild(this.FRAGMENT):this.removeChild(this.FRAGMENT)),this.useShadow?(this.attachedShadow||this.attachShadow({mode:"open"}),this.shadowRoot.prepend(s),this.FRAGMENT=this.shadowRoot.childNodes[0]):this.prepend(s),this.FRAGMENT=this.childNodes[0];let t=new CustomEvent("rendered",{detail:{props:this.props,self:this}});this.dispatchEvent("rendered"),this.oncreate&&this.oncreate(e,this)});o(this,"state",{pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let r of Object.getOwnPropertyNames(this.triggers))this.pushToState[r]&&(this.data[r]=this.pushToState[r],delete this.pushToState[r],this.triggers[r].forEach(s=>{s.onchanged(this.data[r])}));return this.pushToState},subscribeTrigger(e,r=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchanged:r}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,r){let s,t=this.triggers[e];if(t)if(!r)delete this.triggers[e];else return t.find(n=>{if(n.idx===r)return!0})&&t.splice(s,1),!0},subscribeTriggerOnce(e=void 0,r=s=>{}){let s,t=p=>{r(p),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,t)}})}get observedAttributes(){return this.obsAttributes}get obsAttributes(){return this.obsAttributes}set obsAttributes(e){typeof e=="string"?this.obsAttributes.push(e):Array.isArray(e)&&(this.obsAttributes=e)}static get tag(){return this.name.toLowerCase()+"-"}static addElement(e=this.tag,r=this,s=void 0){b(r,e,s)}attributeChangedCallback(e,r,s){if(e==="onchanged"){let t=s;if(typeof t=="string"&&(t=a(t)),typeof t=="function"){this.onchanged=t,this.state.data.props=this.props,this.state.unsubscribeTrigger("props"),this.state.subscribeTrigger("props",this.onchanged);let p=new CustomEvent("changed",{detail:{props:this.props,self:this}});this.state.subscribeTrigger("props",()=>{this.dispatchEvent(p)})}}else if(e==="onresize"){let t=s;if(typeof t=="string"&&(t=a(t)),typeof t=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=p=>{this.onresize(this.props,this)},this.onresize=t,window.addEventListener("resize",this.ONRESIZE)}}else if(e==="ondelete"){let t=s;typeof t=="string"&&(t=a(t)),typeof t=="function"&&(this.ondelete=()=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),t&&t(this.props,this)})}else if(e==="oncreate"){let t=s;typeof t=="string"&&(t=a(t)),typeof t=="function"&&(this.oncreate=t)}else if(e==="renderonchanged"){let t=s;typeof this.renderonchanged=="number"&&this.unsubscribeTrigger(this.renderonchanged),typeof t=="string"&&(t=a(t)),typeof t=="function"?this.renderonchanged=this.state.subscribeTrigger("props",p=>{this.render(p),t(p,this)}):t!=!1&&(this.renderonchanged=this.state.subscribeTrigger("props",this.render))}else if(e==="props"){let t=s;typeof t=="string"&&(t=JSON.parse(t)),Object.assign(this.props,t),this.state.setState({props:this.props})}else if(e==="template"){let t=s;this.template=options.template,typeof t=="function"?this.templateString=this.template(this.props):this.templateString=t,this.render(this.props);let p=new CustomEvent("created",{detail:{props:this.props}});this.dispatchEvent(p)}else{let t=s;if(e.includes("eval_"))e=e.split("_"),e.shift(),e=e.join(),t=a(s);else if(typeof s=="string")try{t=JSON.parse(s)}catch{t=s}this[e]=t,e!=="props"&&(this.props[e]=t)}}connectedCallback(){let e=this.getAttribute("props");typeof e=="string"&&(e=JSON.parse(e)),Object.assign(this.props,e),this.state.setState({props:this.props}),Array.from(this.attributes).forEach(n=>{let h=n.name,l=n.value;if(h.includes("eval_"))h=h.split("_"),h.shift(),h=h.join(),l=a(n.value);else if(typeof n.value=="string")try{l=JSON.parse(n.value)}catch{l=n.value}this[h]||Object.defineProperties(this,n,{value:l,writable:!0,get(){return this[h]},set(u){this.setAttribute(h,u)}}),this[h]=l,h!=="props"&&(this.props[h]=l),this.obsAttributes.push(h)});let r=new CustomEvent("resized",{detail:{props:this.props,self:this}}),s=new CustomEvent("changed",{detail:{props:this.props,self:this}}),t=new CustomEvent("deleted",{detail:{props:this.props,self:this}}),p=new CustomEvent("created",{detail:{props:this.props,self:this}});if(this.styles){let n=`
            <style>
                ${templateStr}
            </style>
            `;this.template.indexOf("<style")?this.template.splice(this.template.indexOf("<style"+7),this.template.indexOf("</style"),templateStr):this.template.indexOf("<head")?this.template.splice(this.template.indexOf("<head"+6),0,n):this.template=n+this.template,this.useShadow=!0}if(this.render(this.props),this.dispatchEvent(p),this.state.subscribeTrigger("props",()=>{this.dispatchEvent(s)}),typeof this.onresize=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=n=>{this.onresize(this.props,this),this.dispatchEvent(r)},window.addEventListener("resize",this.ONRESIZE)}if(typeof this.ondelete=="function"){let n=this.ondelete;this.ondelete=(h=this.props)=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),this.dispatchEvent(t),n(h,this)}}if(typeof this.onchanged=="function"&&(this.state.data.props=this.props,this.state.subscribeTrigger("props",this.onchanged)),this.renderonchanged){let n=this.renderonchanged;typeof this.renderonchanged=="number"&&this.unsubscribeTrigger(this.renderonchanged),typeof n=="string"&&(n=a(n)),typeof n=="function"?this.renderonchanged=this.state.subscribeTrigger("props",h=>{this.render(h),n(h)}):n!==!1&&(this.renderonchanged=this.state.subscribeTrigger("props",this.render))}}get props(){return this.props}set props(e={}){this.setAttribute("props",e)}get template(){return this.template}set template(e){this.setAttribute("template",e)}get render(){return this.render}get delete(){return this.delete}get state(){return this.state}get onchanged(){return this.onchanged}set onchanged(e){this.setAttribute("onchanged",e)}get styles(){return this.styles}set styles(e){let r=`
        <style>
            ${e}
        </style>
        `;this.template.indexOf("<style")?this.template.splice(this.template.indexOf("<style"+7),this.template.indexOf("</style"),e):this.template.indexOf("<head")?this.template.splice(this.template.indexOf("<head"+6),0,r):this.template=r+this.template,this.querySelector("style")?this.useShadow?this.querySelector("style").innerHTML=e:(this.useShadow=!0,this.render()):(this.useShadow=!0,this.render())}get renderonchanged(){return this.renderonchanged}set renderonchanged(e){this.setAttribute("renderonchanged",e)}get onresize(){return this.props}set onresize(e){this.setAttribute("onresize",e)}get ondelete(){return this.props}set ondelete(e){this.setAttribute("ondelete",e)}get oncreate(){return this.oncreate}set oncreate(e){this.setAttribute("oncreated",e)}};function b(i,d,e=null){try{e?d?window.customElements.define(d,i,{extends:e}):window.customElements.define(i.name.toLowerCase()+"-",i,{extends:e}):d?window.customElements.define(d,i):window.customElements.define(i.name.toLowerCase()+"-",i)}catch{}}function w(i=""){return i+Math.floor(Math.random()*1e15)}function a(method){let getFunctionBody=i=>i.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),getFunctionHead=i=>{let d=i.indexOf(")");return i.slice(0,i.indexOf("{",d)+1)},newFuncHead=getFunctionHead(method),newFuncBody=getFunctionBody(method),newFunc;try{if(newFuncHead.includes("function ")){let i=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(i,newFuncBody)}else if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let i=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(i,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else try{newFunc=eval(newFuncHead+newFuncBody+"}")}catch(err){newFunc=eval(method)}}catch(i){}return newFunc}export{c as DOMElement,b as addCustomElement,a as parseFunctionFromText,w as randomId};
