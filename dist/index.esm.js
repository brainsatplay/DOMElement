var f=Object.defineProperty;var g=(h,d,e)=>d in h?f(h,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[d]=e;var p=(h,d,e)=>(g(h,typeof d!="symbol"?d+"":d,e),e);var c=class extends HTMLElement{constructor(){super();p(this,"template",(e,i=this)=>`<div> Custom Fragment Props: ${JSON.stringify(e)} </div>`);p(this,"props",{});p(this,"useShadow",!1);p(this,"styles");p(this,"oncreate");p(this,"onresize");p(this,"ondelete");p(this,"onchanged");p(this,"renderonchanged",!1);p(this,"FRAGMENT");p(this,"STYLE");p(this,"attachedShadow",!1);p(this,"obsAttributes",["props","options","onchanged","onresize","ondelete","oncreate","template"]);p(this,"attributeChangedCallback",(e,i,s)=>{if(e==="onchanged"){let t=s;if(typeof t=="string"&&(t=a(t)),typeof t=="function"){this.onchanged=t,this.state.data.props=this.props,this.state.unsubscribeTrigger("props"),this.state.subscribeTrigger("props",this.onchanged);let r=new CustomEvent("changed",{detail:{props:this.props,self:this}});this.state.subscribeTrigger("props",()=>{this.dispatchEvent(r)})}}else if(e==="onresize"){let t=s;if(typeof t=="string"&&(t=a(t)),typeof t=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=r=>{this.onresize(this.props,this)},this.onresize=t,window.addEventListener("resize",this.ONRESIZE)}}else if(e==="ondelete"){let t=s;typeof t=="string"&&(t=a(t)),typeof t=="function"&&(this.ondelete=()=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),t&&t(this.props,this)})}else if(e==="oncreate"){let t=s;typeof t=="string"&&(t=a(t)),typeof t=="function"&&(this.oncreate=t)}else if(e==="renderonchanged"){let t=s;typeof this.renderonchanged=="number"&&this.unsubscribeTrigger(this.renderonchanged),typeof t=="string"&&(t=a(t)),typeof t=="function"?this.renderonchanged=this.state.subscribeTrigger("props",r=>{this.render(r),t(this,r)}):t!=!1&&(this.renderonchanged=this.state.subscribeTrigger("props",this.render))}else if(e==="props"){let t=s;typeof t=="string"&&(t=JSON.parse(t)),Object.assign(this.props,t),this.state.setState({props:this.props})}else if(e==="template"){let t=s;this.template=t,this.render(this.props);let r=new CustomEvent("created",{detail:{props:this.props}});this.dispatchEvent(r)}else{let t=s;if(e.includes("eval_"))e=e.split("_"),e.shift(),e=e.join(),t=a(s);else if(typeof s=="string")try{t=JSON.parse(s)}catch{t=s}this[e]=t,e!=="props"&&this.props&&(this.props[e]=t)}});p(this,"delete",()=>{this.remove(),typeof this.ondelete=="function"&&this.ondelete(this.props)});p(this,"render",(e=this.props)=>{typeof this.template=="function"?this.templateResult=this.template(e,this):this.templateResult=this.template,this.styles&&(this.templateResult=`<style>${this.styles}</style>${this.templateResult}`);let i=document.createElement("template");typeof this.templateResult=="string"?i.innerHTML=this.templateResult:this.templateResult instanceof HTMLElement&&(this.templateResult.parentNode&&this.templateResult.parentNode.removeChild(this.templateResult),i.appendChild(this.templateResult));let s=i.content;if(this.FRAGMENT&&(this.useShadow?(this.STYLE&&this.shadowRoot.removeChild(this.STYLE),this.shadowRoot.removeChild(this.FRAGMENT)):this.removeChild(this.FRAGMENT)),this.useShadow){if(this.attachedShadow||(this.attachShadow({mode:"open"}).innerHTML="<slot></slot>",this.attachedShadow=!0),this.styles){let r=document.createElement("style");r.textContent=this.styles,this.shadowRoot.prepend(r),this.STYLE=r}this.shadowRoot.prepend(s),this.FRAGMENT=this.shadowRoot.childNodes[0]}else this.prepend(s),this.FRAGMENT=this.childNodes[0];let t=new CustomEvent("rendered",{detail:{props:this.props,self:this}});this.dispatchEvent(t),this.oncreate&&this.oncreate(this,e)});p(this,"state",{pushToState:{},data:{},triggers:{},setState(e){if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0)for(let i of Object.getOwnPropertyNames(this.triggers))this.pushToState[i]&&(this.data[i]=this.pushToState[i],delete this.pushToState[i],this.triggers[i].forEach(s=>{s.onchanged(this.data[i])}));return this.pushToState},subscribeTrigger(e,i=s=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({idx:s,onchanged:i}),this.triggers[e].length-1}else return},unsubscribeTrigger(e,i){let s,t=this.triggers[e];if(t)if(!i)delete this.triggers[e];else return t.find(n=>{if(n.idx===i)return!0})&&t.splice(s,1),!0},subscribeTriggerOnce(e=void 0,i=s=>{}){let s,t=r=>{i(r),this.unsubscribeTrigger(e,s)};s=this.subscribeTrigger(e,t)}})}get observedAttributes(){return this.obsAttributes}get obsAttributes(){return this.obsAttributes}set obsAttributes(e){typeof e=="string"?this.obsAttributes.push(e):Array.isArray(e)&&(this.obsAttributes=e)}static get tag(){return this.name.toLowerCase()+"-"}static addElement(e=this.tag,i=this,s=void 0){b(i,e,s)}connectedCallback(){this.props||(this.props={});let e=this.getAttribute("props");typeof e=="string"&&(e=JSON.parse(e)),Object.assign(this.props,e),this.state.setState({props:this.props}),Array.from(this.attributes).forEach(n=>{let o=n.name,l=n.value;if(o.includes("eval_"))o=o.split("_"),o.shift(),o=o.join(),l=a(n.value);else if(typeof n.value=="string")try{l=JSON.parse(n.value)}catch{l=n.value}this[o]||Object.defineProperties(this,n,{value:l,writable:!0,get(){return this[o]},set(u){this.setAttribute(o,u)}}),this[o]=l,o!=="props"&&(this.props[o]=l),this.obsAttributes.push(o)});let i=new CustomEvent("resized",{detail:{props:this.props,self:this}}),s=new CustomEvent("changed",{detail:{props:this.props,self:this}}),t=new CustomEvent("deleted",{detail:{props:this.props,self:this}}),r=new CustomEvent("created",{detail:{props:this.props,self:this}});if(this.render(this.props),this.dispatchEvent(r),this.state.subscribeTrigger("props",()=>{this.dispatchEvent(s)}),typeof this.onresize=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=n=>{this.onresize(this,this.props),this.dispatchEvent(i)},window.addEventListener("resize",this.ONRESIZE)}if(typeof this.ondelete=="function"){let n=this.ondelete;this.ondelete=(o=this.props)=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),this.dispatchEvent(t),n(this,o)}}if(typeof this.onchanged=="function"&&(this.state.data.props=this.props,this.state.subscribeTrigger("props",this.onchanged)),this.renderonchanged){let n=this.renderonchanged;typeof this.renderonchanged=="number"&&this.unsubscribeTrigger(this.renderonchanged),typeof n=="string"&&(n=a(n)),typeof n=="function"?this.renderonchanged=this.state.subscribeTrigger("props",o=>{this.render(o),n(this,o)}):n!==!1&&(this.renderonchanged=this.state.subscribeTrigger("props",this.render))}}get props(){return this.props}set props(e={}){this.setAttribute("props",e)}get template(){return this.template}set template(e){this.setAttribute("template",e)}get render(){return this.render}get delete(){return this.delete}get state(){return this.state}get onchanged(){return this.onchanged}set onchanged(e){this.setAttribute("onchanged",e)}get styles(){return this.styles}set styles(e){this.styles=e,this.querySelector("style")?this.querySelector("style").innerHTML=e:this.render()}get renderonchanged(){return this.renderonchanged}set renderonchanged(e){this.setAttribute("renderonchanged",e)}get onresize(){return this.props}set onresize(e){this.setAttribute("onresize",e)}get ondelete(){return this.props}set ondelete(e){this.setAttribute("ondelete",e)}get oncreate(){return this.oncreate}set oncreate(e){this.setAttribute("oncreated",e)}};function b(h,d,e=null){try{e?d?window.customElements.define(d,h,{extends:e}):window.customElements.define(h.name.toLowerCase()+"-",h,{extends:e}):d?window.customElements.define(d,h):window.customElements.define(h.name.toLowerCase()+"-",h)}catch{}}function m(h=""){return h+Math.floor(Math.random()*1e15)}function a(h){let d=r=>r.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),i=(r=>{let n=r.indexOf(")");return r.slice(0,r.indexOf("{",n)+1)})(h),s=d(h),t;try{if(i.includes("function ")){let r=i.split("(")[1].split(")")[0];t=new Function(r,s)}else if(i.substring(0,6)===s.substring(0,6)){let r=i.split("(")[1].split(")")[0];t=new Function(r,s.substring(s.indexOf("{")+1,s.length-1))}else try{t=(0,eval)(i+s+"}")}catch{t=(0,eval)(h)}}catch{}return t}export{c as DOMElement,b as addCustomElement,a as parseFunctionFromText,m as randomId};
